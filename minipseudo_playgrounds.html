<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=768, user-scalable=no" />
    <title>Minipseudo Playgrounds</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --bg-color: #0f172a;
            --secondary-bg: #1e293b;
            --border-color: #334155;
            --text-color: #e2e8f0;
            --text-muted: #94a3b8;
            --hover-color: #2563eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            background: var(--bg-color);
            color: var(--text-color);
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .workspace {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .editor-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        #editor-container {
            height: 400px;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;
            background: var(--secondary-bg);
        }

        #console-output {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            height: 400px;
            overflow-y: auto;
            white-space: pre;
            color: #a5f3fc;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        button:hover {
            background: var(--hover-color);
            transform: translateY(-1px);
        }

        .section-title {
            font-size: 1.1rem;
            color: var(--text-color);
            margin: 1.5rem 0 0.5rem 0;
            font-weight: 500;
        }

        .footer {
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Console styling */
        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .console-clear {
            background: transparent;
            border: 1px solid var(--border-color);
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }

        .console-clear:hover {
            background: var(--border-color);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>Minipseudo Playgrounds</h1>

        <div class="workspace">
            <div class="editor-section">
                <div class="button-group">
                    <button id="buttonRun" onclick="myRunSorcecode()">
                        <span>▶</span> Start
                    </button>
                </div>

                <div class="section-title">Programmiere hier:</div>
                <div id="editor-container"></div>

                <div class="section-title">Lade ein Programmbeispiel:</div>
                <div class="button-group">
                    <button onclick="loadExample('PG1')">Playground 1</button>
                    <button onclick="loadExample('PG2')">Playground 2</button>
                    <button onclick="loadExample('PG3')">Playground 3</button>
                </div>
            </div>

            <div class="console-section">
                <div class="console-header">
                    <div class="section-title">Konsole:</div>
                    <button class="console-clear" onclick="clearConsole()">Clear</button>
                </div>
                <div id="console-output"></div>
            </div>
        </div>

        <div class="footer">
            <small><i>Version 1.0 <a href="https://github.com/jensgraetzer/minipseudo">Download Minipseudo Playgrounds von GitHub</a></i></small>
        </div>
    </div>

    <script>
        // Code examples
        const sourceCode = {
            PG1: `// PG1) Zwei Schritte, Rechtsdrehen, zwei Schritte
			
//Hey, Maurice aka. Zaind war hier :)

showGround()
moveForward()
moveForward()
turnRight()
moveForward()
moveForward()
showGround()
writeLine("PROGRAMM ENDE")`,
            PG2: `// PG2) Nach rechts am Rand entlang

showGround()
moveForward()
moveForward()
moveForward()
turnRight()
moveForward()
moveForward()
moveForward()
showGround()`,
            PG3: `// PG3) Aufgabe: Programmiere einen Roboter-Staubsauger!

showGround()
moveForward()
moveForward()



showGround()
writeLine("ZIMMER SAUBER")`
        };

        let editor;
        let myStorageKey = 'sandbox_08158873';
        let printOutputString = "";
        const consoleOutput = document.getElementById('console-output');

        // Initialize Monaco Editor with dark theme
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: localStorage.getItem(myStorageKey) || sourceCode.PG1,
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                fontSize: 14,
                tabSize: 2,
                renderWhitespace: 'boundary',
                formatOnPaste: true,
                formatOnType: true
            });

            editor.onDidChangeModelContent(() => {
                localStorage.setItem(myStorageKey, editor.getValue());
            });
        });

        function loadExample(key) {
            if (editor && sourceCode[key]) {
                editor.setValue(sourceCode[key]);
            }
        }

        function clearConsole() {
            consoleOutput.textContent = '';
        }

        class RunArea {
            constructor(codeStr) {
                let posx = 0;
                let posy = 0;
                let direction = "E";
                let dirsym = ">";
                let footprint = "$";
                let nr = 0;
                let ctr = 0;

                let ground = [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0]
                ];
                let dimx = ground.length;
                let dimy = ground[0].length;

                try {
                    printOutputString = "";
                    eval(codeStr);
                    if(printOutputString != "") {
                        consoleOutput.textContent += printOutputString;
                    }
                } catch(err) {
                    consoleOutput.textContent += "SYNTAX FEHLER\n" + err.message + "\n";
                }

                function print(printText) {
                    printOutputString += printText;
                }

                function input(titleText) {
                    if(titleText == undefined) titleText = "Deine Eingabe:";
                    return prompt(titleText, "");
                }

                function output(text) {
                    consoleOutput.textContent += text + "\n";
                }

                function random(n) {
                    return Math.floor(Math.random() * Math.floor(n));
                }

                function ord(someCharString) {
                    return someCharString.charCodeAt(0);
                }

                function chr(nr) {
                    return String.fromCharCode(nr);
                }

                function showGround() {
                    writeDirection();
                    for(let i = 0; i < dimx; i++) {
                        for(let j = 0; j < dimy; j++) {
                            print(ground[i][j] + "    ");
                        }
                        print("\n");
                    }
                    print("--------------\n");
                }

                function moveForward() {
                    ground[posx][posy] = footprint;
                    
                    if(direction == "E") {
                        if (posy < dimy - 1) posy++;
                        else {
                            print("> Kollision [" + posx + "][" + posy + "]\n--------------\n");
                            showGround();
                            if(window.stop) window.stop();
                        }
                    }
                    else if (direction == "S") {
                        if (posx < dimx - 1) posx++;
                        else {
                            print("v Kollision [" + posx + "][" + posy + "]\n--------------\n");
                            showGround();
                            if(window.stop) window.stop();
                        }
                    }
                    else if (direction == "W") {
                        if (posy > 0) posy--;
                        else {
                            print("< Kollision [" + posx + "][" + posy + "]\n--------------\n");
                            showGround();
                            if(window.stop) window.stop();
                        }
                    }
                    else if (direction == "N") {
                        if (posx > 0) posx--;
                        else {
                            print("^ Kollision [" + posx + "][" + posy + "]\n--------------\n");
                            showGround();
                            if(window.stop) window.stop();
                        }
                    }
                    ctr++;
                    writeDirection();
                }

                function turnRight() {
                    if(direction == "E") direction = "S";
                    else if (direction == "S") direction = "W";
                    else if (direction == "W") direction = "N";
                    else direction = "E";
                    writeDirection();
                }

                function writeDirection() {
                    dirsym = direction == "E" ? ">" : 
                            direction == "S" ? "v" : 
                            direction == "W" ? "<" : "^";
                    ground[posx][posy] = dirsym;
                }

                function writeLine(text) {
                    print(text + "\n");
                }
            }
        }

        function myRunSorcecode() {
            new RunArea(editor.getValue());
        }
    </script>
</body>
</html>